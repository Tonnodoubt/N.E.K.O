# 💎 UI 重构过程中的高价值经验总结

在 Project N.E.K.O. 的 UI 系统从零散样式向 V1.0 规范进化的过程中，我们积累了以下极具价值的技术经验与坑点解决方案。

## 1. 视觉特效：高密度阴影矩阵 (High-Density Shadow Matrix)

**挑战**：传统的 `-webkit-text-stroke` 在描边较粗时，文字端点会变得尖锐且生硬，无法达到“圆润”的卡通感。

**解决方案**：
我们开发了一套基于 20 层 `text-shadow` 的矩阵算法。通过在 360 度方向上每隔 18-20 度设置一个偏移阴影，模拟出一个完美的圆形描边。
*   **核心公式**：`X = R * cos(θ), Y = R * sin(θ)`
*   **价值**：实现了即使在低分辨率屏幕下也极其平滑、圆润的文字描边效果，成为了 N.E.K.O. 的视觉名片。

## 2. 国际化与图标冲突 (i18n vs. HTML Tags)

**挑战**：在使用 `i18next` 等翻译框架时，默认的 `textContent` 更新会抹除按钮内原本存在的 `<img>` 图标标签。

**解决方案**：
*   **动态检测**：在 i18n 更新逻辑中增加 HTML 标签检测。如果翻译字符串包含 `<img>` 或 `<span`，则切换为 `innerHTML` 更新。
*   **翻译嵌入**：直接在 JSON 翻译文件中定义带图标的 HTML 片段，确保图标与文字同步切换语言。

## 3. 胶囊化表单的“溢出”陷阱 (The Overflow Trap)

**挑战**：为了实现圆角效果，通常会给父容器设置 `overflow: hidden`，这会导致原生的 `<select>` 下拉菜单在展开时被截断。

**解决方案**：
*   **局部开放**：对包含下拉框的 `.field-row` 显式设置 `overflow: visible !important`。
*   **层级管理**：为展开状态的下拉框设置 `z-index: 1000`，确保其悬浮在所有胶囊框之上。

## 4. 渐进式重构策略 (Progressive Migration)

**挑战**：项目页面众多，一次性全量重构风险极高且难以调试。

**经验**：
1.  **定义模范页面**：先将 `chara_manager.html` 彻底重构为理想状态，作为视觉基准。
2.  **视觉残留清理**：通过 `grep` 搜索旧的颜色值（如 `#333`）和圆角值（如 `6px`），系统化地清理“视觉垃圾”。
3.  **CSS 拆分**：将内联样式剥离到独立的 CSS 文件中，极大提升了 Cursor 等 AI 工具的理解与编辑效率。

## 5. 交互反馈：按钮的“按下感”

**经验**：
一个好的 UI 不仅要好看，还要好用。我们统一了所有按钮的交互公式：
*   **Hover**: `translateY(-1px)` + 增强阴影（向上浮动，吸引点击）。
*   **Active**: `translateY(1px)` + `scale(0.98)`（向下压实，模拟物理按键）。
*   **价值**：这种微小的动效极大提升了用户操作的确定性。

---
*这些经验已整合进 UI 系统重构 Skill，作为后续开发的避坑指南。*
